const data = {
    "asientos": [
        {
            "numero": 1,
            "precio": 50,
            "estado": "disponible",
            "piso": 1,
            "columna": 5,
            "fila": 4
        },
        {
            "numero": 2,
            "precio": 50,
            "estado": "disponible",
            "piso": 1,
            "columna": 3,
            "fila": 4
        },
        {
            "numero": 3,
            "precio": 50,
            "estado": "disponible",
            "piso": 1,
            "columna": 2,
            "fila": 4
        },
        {
            "numero": 4,
            "precio": 50,
            "estado": "disponible",
            "piso": 1,
            "columna": 5,
            "fila": 3
        },
        {
            "numero": 5,
            "precio": 50,
            "estado": "disponible",
            "piso": 1,
            "columna": 3,
            "fila": 3
        },
        {
            "numero": 6,
            "precio": 50,
            "estado": "disponible",
            "piso": 1,
            "columna": 2,
            "fila": 3
        },
        {
            "numero": 7,
            "precio": 50,
            "estado": "disponible",
            "piso": 1,
            "columna": 5,
            "fila": 2
        },
        {
            "numero": 8,
            "precio": 50,
            "estado": "disponible",
            "piso": 1,
            "columna": 3,
            "fila": 2
        },
        {
            "numero": 9,
            "precio": 50,
            "estado": "disponible",
            "piso": 1,
            "columna": 2,
            "fila": 2
        },
        {
            "numero": 10,
            "precio": 50,
            "estado": "disponible",
            "piso": 1,
            "columna": 5,
            "fila": 1
        },
        {
            "numero": 11,
            "precio": 50,
            "estado": "disponible",
            "piso": 1,
            "columna": 3,
            "fila": 1
        },
        {
            "numero": 12,
            "precio": 50,
            "estado": "disponible",
            "piso": 1,
            "columna": 2,
            "fila": 1
        },
        {
            "numero": 13,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 5,
            "fila": 19
        },
        {
            "numero": 14,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 2,
            "fila": 19
        },
        {
            "numero": 15,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 3,
            "fila": 19
        },
        {
            "numero": 16,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 5,
            "fila": 16
        },
        {
            "numero": 17,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 2,
            "fila": 18
        },
        {
            "numero": 18,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 3,
            "fila": 18
        },
        {
            "numero": 19,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 5,
            "fila": 15
        },
        {
            "numero": 20,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 2,
            "fila": 17
        },
        {
            "numero": 21,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 3,
            "fila": 17
        },
        {
            "numero": 22,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 5,
            "fila": 14
        },
        {
            "numero": 23,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 2,
            "fila": 16
        },
        {
            "numero": 24,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 3,
            "fila": 16
        },
        {
            "numero": 25,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 5,
            "fila": 13
        },
        {
            "numero": 26,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 2,
            "fila": 15
        },
        {
            "numero": 27,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 3,
            "fila": 15
        },
        {
            "numero": 28,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 5,
            "fila": 12
        },
        {
            "numero": 29,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 2,
            "fila": 14
        },
        {
            "numero": 30,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 3,
            "fila": 14
        },
        {
            "numero": 31,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 5,
            "fila": 11
        },
        {
            "numero": 32,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 2,
            "fila": 13
        },
        {
            "numero": 33,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 3,
            "fila": 13
        },
        {
            "numero": 34,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 2,
            "fila": 12
        },
        {
            "numero": 35,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 3,
            "fila": 12
        },
        {
            "numero": 36,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 2,
            "fila": 11
        },
        {
            "numero": 37,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 3,
            "fila": 11
        },
        {
            "numero": 38,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 2,
            "fila": 10
        },
        {
            "numero": 39,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 3,
            "fila": 10
        },
        {
            "numero": 40,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 2,
            "fila": 9
        },
        {
            "numero": 41,
            "precio": 40,
            "estado": "disponible",
            "piso": 2,
            "columna": 3,
            "fila": 9
        }
    ],
    "amenidades": [
        {
            "tipo": "tv",
            "piso": 1,
            "columna": 4,
            "fila": 5
        },
        {
            "tipo": "tv",
            "piso": 2,
            "columna": 4,
            "fila": 20
        },
        {
            "tipo": "TV",
            "piso": 2,
            "columna": 5,
            "fila": 10
        }
    ]
    
}

export function Comet() {
    const asientos = data.asientos;
    const amenidades = data.amenidades;
    // Agrupar por piso
    const pisos: Record<string, any[]> = {};
    let maxCol: Record<string, number> = {};
    let maxRow: Record<string, number> = {};
    asientos.forEach(a => {
        const piso = a.piso;
        if (!pisos[piso]) pisos[piso] = [];
        pisos[piso].push({ ...a, tipo: 'asiento' });
        const col = Number(a.columna);
        const row = Number(a.fila);
        maxCol[piso] = Math.max(maxCol[piso] || 0, col);
        maxRow[piso] = Math.max(maxRow[piso] || 0, row);
    });
    amenidades.forEach(a => {
        const piso = a.piso;
        if (!pisos[piso]) pisos[piso] = [];
        pisos[piso].push({ ...a, tipo: 'amenidad' });
        const col = Number(a.columna);
        const row = Number(a.fila);
        maxCol[piso] = Math.max(maxCol[piso] || 0, col);
        maxRow[piso] = Math.max(maxRow[piso] || 0, row);
    });

    const renderAsiento = (a: any) => {
        if (a.tipo === 'amenidad' && a.tipo !== 'asiento') {
            if ((a.tipo === 'amenidad' && (a.tipo === 'tv' || a.tipo === 'TV')) || a.tipo === 'tv' || a.tipo === 'TV') {
                return <span style={{background:'#222',color:'#fff',padding:'2px 6px',borderRadius:4,display:'inline-block'}}>tv</span>;
            }
        }
        if (a.tipo === 'asiento') {
            const ocupado = a.estado !== 'disponible';
            return (
                <span style={{
                    background: ocupado ? '#e53935' : '#43a047',
                    color: '#fff',
                    padding: '2px 6px',
                    borderRadius: 4,
                    display: 'inline-block',
                    minWidth: 24,
                    textAlign: 'center',
                    opacity: ocupado ? 0.6 : 1,
                    border: ocupado ? '2px solid #b71c1c' : '2px solid #1b5e20',
                }}>
                    {a.numero}
                </span>
            );
        }
        return null;
    };

    return (
        <div>
            <h2>Layout de bus COMET</h2>
            <div style={{ display: 'flex', gap: 32 }}>
                {Object.entries(pisos).map(([piso, asientosPiso]) => {
                    // Agrupo por posici√≥n para poder mostrar amenidades y asientos juntos
                    const posiciones: Record<string, any[]> = {};
                    asientosPiso.forEach(a => {
                        const key = `${a.columna}-${a.fila}`;
                        if (!posiciones[key]) posiciones[key] = [];
                        posiciones[key].push(a);
                    });
                    return (
                        <div key={piso}>
                            <h3>Piso {piso}</h3>
                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: `repeat(${maxCol[piso]}, 40px)`,
                                gridTemplateRows: `repeat(${maxRow[piso]}, 40px)`,
                                gap: 6,
                                background: '#222',
                                padding: 12,
                                borderRadius: 8,
                                boxShadow: '0 2px 8px #0002',
                            }}>
                                {Array.from({ length: maxRow[piso] }).map((_, yIdx) =>
                                    Array.from({ length: maxCol[piso] }).map((_, xIdx) => {
                                        const key = `${xIdx + 1}-${yIdx + 1}`;
                                        const elementos = posiciones[key] || [];
                                        return (
                                            <div key={xIdx + '-' + yIdx} style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: 32, flexDirection: 'column' }}>
                                                {elementos.map((el) => renderAsiento(el))}
                                            </div>
                                        );
                                    })
                                )}
                            </div>
                        </div>
                    );
                })}
            </div>
            <div style={{marginTop:16}}>
                <span style={{background:'#43a047',color:'#fff',padding:'2px 6px',borderRadius:4,marginRight:8}}>Libre</span>
                <span style={{background:'#e53935',color:'#fff',padding:'2px 6px',borderRadius:4,marginRight:8}}>Ocupado</span>
                <span style={{background:'#222',color:'#fff',padding:'2px 6px',borderRadius:4,marginRight:8}}>tv: TV</span>
            </div>
        </div>
    );
}