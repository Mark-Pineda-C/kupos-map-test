const data = {
    "respuesta": 1,
    "mapabus": [
        {
            "asiento": "1 ",
            "tarifaAsiento": 140.0,
            "estadoAsiento": 1,
            "piso": 1,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 345,
            "ttop": 105
        },
        {
            "asiento": "2 ",
            "tarifaAsiento": 140.0,
            "estadoAsiento": 0,
            "piso": 1,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 825,
            "ttop": 105
        },
        {
            "asiento": "3 ",
            "tarifaAsiento": 140.0,
            "estadoAsiento": 0,
            "piso": 1,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 2285,
            "ttop": 105
        },
        {
            "asiento": "T1",
            "tarifaAsiento": 0.0,
            "estadoAsiento": 1,
            "piso": 1,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 1,
            "lleft": 1560,
            "ttop": 120
        },
        {
            "asiento": "4 ",
            "tarifaAsiento": 140.0,
            "estadoAsiento": 0,
            "piso": 1,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 345,
            "ttop": 465
        },
        {
            "asiento": "5 ",
            "tarifaAsiento": 140.0,
            "estadoAsiento": 0,
            "piso": 1,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 825,
            "ttop": 465
        },
        {
            "asiento": "6 ",
            "tarifaAsiento": 140.0,
            "estadoAsiento": 0,
            "piso": 1,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 2285,
            "ttop": 465
        },
        {
            "asiento": "7 ",
            "tarifaAsiento": 140.0,
            "estadoAsiento": 0,
            "piso": 1,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 345,
            "ttop": 825
        },
        {
            "asiento": "8 ",
            "tarifaAsiento": 140.0,
            "estadoAsiento": 0,
            "piso": 1,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 825,
            "ttop": 825
        },
        {
            "asiento": "9 ",
            "tarifaAsiento": 140.0,
            "estadoAsiento": 0,
            "piso": 1,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 2285,
            "ttop": 840
        },
        {
            "asiento": "T2",
            "tarifaAsiento": 0.0,
            "estadoAsiento": 1,
            "piso": 1,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 1,
            "lleft": 600,
            "ttop": 1860
        },
        {
            "asiento": "10",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 345,
            "ttop": 2235
        },
        {
            "asiento": "11",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 825,
            "ttop": 2235
        },
        {
            "asiento": "T3",
            "tarifaAsiento": 0.0,
            "estadoAsiento": 1,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 1,
            "lleft": 1980,
            "ttop": 2250
        },
        {
            "asiento": "12",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 2285,
            "ttop": 2580
        },
        {
            "asiento": "13",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 1800,
            "ttop": 2595
        },
        {
            "asiento": "14",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 345,
            "ttop": 2610
        },
        {
            "asiento": "15",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 825,
            "ttop": 2610
        },
        {
            "asiento": "16",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 2285,
            "ttop": 2955
        },
        {
            "asiento": "17",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 1800,
            "ttop": 2955
        },
        {
            "asiento": "18",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 345,
            "ttop": 2985
        },
        {
            "asiento": "19",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 825,
            "ttop": 2985
        },
        {
            "asiento": "20",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 2285,
            "ttop": 3330
        },
        {
            "asiento": "21",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 1800,
            "ttop": 3330
        },
        {
            "asiento": "22",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 345,
            "ttop": 3330
        },
        {
            "asiento": "23",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 825,
            "ttop": 3345
        },
        {
            "asiento": "T4",
            "tarifaAsiento": 0.0,
            "estadoAsiento": 1,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 1,
            "lleft": 1335,
            "ttop": 3345
        },
        {
            "asiento": "24",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 2285,
            "ttop": 3690
        },
        {
            "asiento": "25",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 1800,
            "ttop": 3690
        },
        {
            "asiento": "26",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 345,
            "ttop": 3705
        },
        {
            "asiento": "27",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 825,
            "ttop": 3705
        },
        {
            "asiento": "31",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 825,
            "ttop": 4050
        },
        {
            "asiento": "28",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 2285,
            "ttop": 4065
        },
        {
            "asiento": "29",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 1,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 1800,
            "ttop": 4065
        },
        {
            "asiento": "30",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 345,
            "ttop": 4065
        },
        {
            "asiento": "34",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 345,
            "ttop": 4410
        },
        {
            "asiento": "32",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 2285,
            "ttop": 4425
        },
        {
            "asiento": "35",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 825,
            "ttop": 4425
        },
        {
            "asiento": "33",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 1800,
            "ttop": 4440
        },
        {
            "asiento": "38",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 345,
            "ttop": 4755
        },
        {
            "asiento": "39",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 825,
            "ttop": 4755
        },
        {
            "asiento": "36",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 2285,
            "ttop": 4800
        },
        {
            "asiento": "37",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 1,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 1800,
            "ttop": 4800
        },
        {
            "asiento": "40",
            "tarifaAsiento": 110.0,
            "estadoAsiento": 0,
            "piso": 2,
            "cantidadAsientos": 41,
            "numeroPisos": 2,
            "tipoObjeto": 0,
            "lleft": 345,
            "ttop": 5115
        }
    ]
}

export function PalmaWari() {
    const asientos = data.mapabus;
    // Agrupar por piso
    const pisos: Record<string, any[]> = {};
    let minLeft: Record<string, number> = {};
    let minTop: Record<string, number> = {};
    let maxLeft: Record<string, number> = {};
    let maxTop: Record<string, number> = {};
    asientos.forEach(a => {
        const piso = a.piso;
        if (!pisos[piso]) pisos[piso] = [];
        pisos[piso].push(a);
        minLeft[piso] = Math.min(minLeft[piso] ?? a.lleft, a.lleft / 10);
        minTop[piso] = Math.min(minTop[piso] ?? a.ttop, a.ttop / 10);
        maxLeft[piso] = Math.max(maxLeft[piso] ?? a.lleft, a.lleft / 10);
        maxTop[piso] = Math.max(maxTop[piso] ?? a.ttop, a.ttop / 10);
    });

    // Normalizar posiciones a una cuadrícula de 10x10 (o lo que corresponda)
    const gridSize = 60; // tamaño de celda visual

    const renderAsiento = (a: any) => {
        if (a.tipoObjeto === 1) return <span style={{background:'#222',color:'#fff',padding:'2px 6px',borderRadius:4,display:'inline-block'}}>T</span>;
        if (a.tipoObjeto === 0) {
            const ocupado = a.estadoAsiento === 1;
            return (
                <span style={{
                    background: ocupado ? '#e53935' : '#43a047',
                    color: '#fff',
                    padding: '2px 6px',
                    borderRadius: 4,
                    display: 'inline-block',
                    minWidth: 24,
                    textAlign: 'center',
                    opacity: ocupado ? 0.6 : 1,
                    border: ocupado ? '2px solid #b71c1c' : '2px solid #1b5e20',
                }}>
                    {a.asiento.trim()}
                </span>
            );
        }
        return null;
    };

    return (
        <div>
            <h2>Layout de bus PALMAWARI</h2>
            <div style={{ display: 'flex', gap: 32 }}>
                {Object.entries(pisos).map(([piso, asientosPiso]) => {
                    const minL = minLeft[piso];
                    const minT = minTop[piso];
                    return (
                        <div key={piso}>
                            <h3>Piso {piso}</h3>
                            <div style={{
                                position: 'relative',
                                width: (Math.ceil((maxLeft[piso] - minL) / gridSize) + 2) * gridSize / 2,
                                height: (Math.ceil((maxTop[piso] - minT) / gridSize) + 2) * gridSize / 2,
                                background: '#222',
                                padding: 12,
                                borderRadius: 8,
                                boxShadow: '0 2px 8px #0002',
                            }}>
                                {asientosPiso.map((a, idx) => (
                                    <div
                                        key={idx}
                                        style={{
                                            position: 'absolute',
                                            left: ((a.lleft / 10 - minL) / gridSize) * gridSize + 10,
                                            top: ((a.ttop / 10 - minT) / gridSize) * gridSize + 10,
                                            width: gridSize - 8,
                                            height: gridSize - 8,
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                        }}
                                    >
                                        {renderAsiento(a)}
                                    </div>
                                ))}
                            </div>
                        </div>
                    );
                })}
            </div>
            <div style={{marginTop:16}}>
                <span style={{background:'#43a047',color:'#fff',padding:'2px 6px',borderRadius:4,marginRight:8}}>Libre</span>
                <span style={{background:'#e53935',color:'#fff',padding:'2px 6px',borderRadius:4,marginRight:8}}>Ocupado</span>
                <span style={{background:'#222',color:'#fff',padding:'2px 6px',borderRadius:4,marginRight:8}}>T: TV</span>
            </div>
        </div>
    );
}